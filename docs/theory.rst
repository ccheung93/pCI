Theory
======

For any many-electron system, we can divide all electrons into core and valence electrons. In this way, we can separate the electron-electron correlation problem into one describing the valence-valence correlations under the frozen-core approximation, and another describing the core-core and core-valence correlations. In the initial approximation, we start from the solution of the restricted Dirac-Hartree-Fock (HFD) equations in the central field approximation to construct one-electron orbitals for the core and valence electrons. Virtual orbitals can be constructed from B-splines or by other means to account for correlations. The valence-valence correlation problem is solved using the CI method, while core-core and core-valence correlations are included using either MBPT or the all-order method. In either case, we form an effective Hamiltonian in the valence CI space, then diagonalize the effective Hamiltonian using the CI method to find energies and wave functions for the low-lying states.

Configuration Interaction
-------------------------
The CI method is a standard *ab initio* method for calculating atomic properties of many-electron systems. In the valence space, the CI wave function is constructed as a linear combination of all distinct states of a specified angular momentum :math:`J` and parity

.. math:: 
    
    \Psi_J=\sum_ic_i\Phi_i, 

where the set :math:`\left\{\Phi_i\right\}` are Slater determinants generated by exciting electrons from some reference configurations obtained to higher orbitals. 

Varying the coefficients :math:`c_i` results in a generalized eigenvalue problem

.. math:: 
    
    \sum_j\langle\Phi_i|H|\Phi_j\rangle c_j = Ec_i,

which can be written in matrix form and diagonalized to find the energies and wave functions of the low-lying states. The energy matrix of the CI method can be obtained as a projection of the exact Hamiltonian :math:`H` onto the CI subspace :math:`H^\text{CI}`\ :footcite:p:`Dzuba1996`

.. math::

    H^\text{CI}=E_\text{core}+\sum_{i>N_\text{core}}h_i^\text{CI}+\sum_{j>i>N_\text{core}}V_{ij},

where :math:`E_\text{core}` is the energy of the frozen core, :math:`N_\text{core}` is the number of core electrons, :math:`h_i^\text{CI}` accounts for the kinetic energy of the valence electrons and their interaction with the central field, and :math:`V_{ij}` accounts for the valence-valence correlations. 

Having obtained from CI the many-electron states :math:`|J M\rangle` and :math:`|J' M'\rangle` with the total angular momenta :math:`J,J'` and their projections :math:`M,M'`, one can form density transition matrix in terms of the one-electron states :math:`|nljm\rangle`\ :footcite:p:`KozPorSaf15`

.. math:: 

    \hat{\rho}=\rho_{nljm,n^\prime l^\prime j^\prime m^\prime}|nljm\rangle\langle n^\prime l^\prime j^\prime m^\prime|, 

where

.. math::

    \rho_{nljm,n^\prime l^\prime j^\prime m^\prime}=\langle J^\prime M^\prime|a_{n^\prime l^\prime j^\prime m^\prime}^\dagger a_{nljm}|JM\rangle. 

Here un-primed indices refer to the initial state and primed indices refer to the final state. The many-electron matrix element can then be written as 

.. math::

    \langle J^\prime M^\prime|T_q^L|JM\rangle=\text{Tr}\,\rho_{nljm,n^\prime l^\prime j^\prime m^\prime}\langle n^\prime l^\prime j^\prime m^\prime|T_q^L|nljm\rangle

where the trace sums over all quantum numbers :math:`(nljm)` and :math:`(n^\prime l^\prime j^\prime m^\prime)`, and :math:`T_q^L` is the spherical component of the tensor operator of rank :math:`L`. Using the Wigner-Eckart theorem, one can reduce the many-electron matrix element to

.. math::

    \langle J^\prime \Vert T^L \Vert J\rangle = \text{Tr}\,\rho_{nlj,n^\prime l^\prime j^\prime}^L \langle n^\prime l^\prime j^\prime\Vert T^L \Vert nlj\rangle, 

where

.. math::

    \rho_{nlj,n^\prime l^\prime j^\prime}^L = (-1)^{J^\prime -M^\prime}\left(
    \begin{array}{ccc}
        J^\prime & L & J \\ -M^\prime & q & M
    \end{array}\right)^{-1} \sum_{mm^\prime} (-1)^{j^\prime-m^\prime}\left(
    \begin{array}{ccc}
        j^\prime & L & j \\ -m^\prime & q & m
    \end{array}\right) \rho_{nljm,n^\prime l^\prime j^\prime m^\prime}. 

We have developed new parallel programs based on these methods: `conf` realizes the CI method, which forms the CI Hamiltonian and uses Davidson's algorithm of diagonalization\ :footcite:p:`Davidson1975` to find low-lying energies and wave functions; `dtm` calculates reduced matrix elements of one-electron operators by forming the reduced density transition matrices.

Valence Perturbation Theory
---------------------------

As the number of configurations contributing to the CI wave function grows exponentially with the number of valence electrons, efficient selection of the most important configurations from a set of configurations becomes the main challenge of accurate computations. To significantly reduce the number of configurations, we further developed a method suggested in Ref.\ :footcite:p:`RKP01e` to predict important configurations based on a set of configurations with known weights. This method can be used to optimize the CI space by identifying the most important configurations from a list of CI configurations using perturbation theory (PT). 

All second-order corrections are taken into account and added to the energy calculated from CI to obtain the total energy, :math:`E^\text{CI}=E_0+E_1`, while first-order corrections to the wave functions are stored for use in subsequent CI calculations. This process of using CI on a small subspace, calculating corrections via PT, and reordering the list of configurations in descending weights can be repeated several times to form the most optimal CI subspace. Once the energy differences between subsequent CI calculations are relatively small, it can be assumed that convergence has been met. 

We've developed a new parallel program `conf_pt` that realizes the CI+PT method. The parallel version enables computations of extremely large problems, with tests running up to 400 million determinants. 

References
----------

.. footbibliography::